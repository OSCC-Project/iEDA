/*
Gutengerg Post Parser, the C bindings.

Warning, this file is autogenerated by `cbindgen`.
Do not modify this manually.

*/

#include <stdarg.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>

#define POWER_INNER_RESISTANCE 1e-3

#define RC_COEFF 3.0

typedef struct HashMap_usize__f64 HashMap_usize__f64;

/**
 * IR PG node of the PG netlist.
 */
typedef struct RustIRPGNode RustIRPGNode;

/**
 * The iterator for Rust hash map, temporarily write here.
 */
typedef struct HashMapIterator {
    struct HashMap_usize__f64 *hashmap;
    Iter<uintptr_t, double> iter;
} HashMapIterator;

/**
 * IR PG edge of the PG netlist.
 */
typedef struct RustIRPGEdge {
    int64_t node1;
    int64_t node2;
    double resistance;
} RustIRPGEdge;

/**
 * Rust vec to C vec
 */
typedef struct RustVec {
    void *data;
    uintptr_t len;
    uintptr_t cap;
    uintptr_t type_size;
} RustVec;

/**
 * One net conductance matrix data for C.
 */
typedef struct RustNetConductanceData {
    const char *net_name;
    uintptr_t node_num;
    struct RustVec g_matrix_vec;
    const void *ir_net_raw_ptr;
} RustNetConductanceData;

void init_iir(void);

struct HashMapIterator *create_hashmap_iterator(struct HashMap_usize__f64 *hashmap);

bool hashmap_iterator_next(struct HashMapIterator *iterator, uintptr_t *out_key, double *out_value);

void destroy_hashmap_iterator(struct HashMapIterator *iterator);

const void *read_spef(const char *c_power_net_spef);

/**
 * create power ground node.
 */
const void *create_pg_node(void *c_pg_netlist, const struct RustIRPGNode *c_pg_node);

/**
 * create power ground edge.
 */
const void *create_pg_edge(const void *c_pg_netlist, const struct RustIRPGEdge *c_pg_edge);

/**
 * create power ground netlist.
 */
const void *create_pg_netlist(const char *c_power_net_name);

/**
 * estimate all pg netlist rc data.
 */
const void *create_rc_data(const void *c_pg_netlist_ptr, uintptr_t len);

double get_sum_resistance(const void *c_rc_data, const char *c_net_name);

struct RustNetConductanceData build_one_net_conductance_matrix_data(const void *c_rc_data,
                                                                    const char *c_net_name);

/**
 * Read instance power csv file for C.
 */
void *read_inst_pwr_csv(const char *file_path);

void *set_instance_power_data(struct RustVec c_instance_power_data);

/**
 * Build one net instance current vector.
 */
void *build_one_net_instance_current_vector(const void *c_instance_power_data,
                                            const void *c_rc_data,
                                            const char *c_net_name);

/**
 * Get one net bump node id.
 */
struct RustVec get_bump_node_ids(const void *c_rc_data, const char *c_net_name);

struct RustVec get_instance_node_ids(const void *c_rc_data, const char *c_net_name);

const char *get_instance_name(const void *c_rc_data, const char *c_net_name, uintptr_t node_id);

/**
 * Build RC matrix and current vector data.
 */
struct RustVec build_matrix_from_raw_data(const char *c_inst_power_path,
                                          const char *c_power_net_spef);
